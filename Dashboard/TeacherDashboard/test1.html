<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teacher Dashboard Pro - University Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              dark: {
                bg: "#1a1c23",
                card: "#24262d",
                text: "#e2e8f0",
              },
            },
          },
        },
      };
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap");

      body {
        font-family: "Inter", sans-serif;
        transition: background-color 0.3s, color 0.3s;
      }

      /* Dark Mode Styles */
      body.dark-mode {
        background-color: #111827;
        color: #f3f4f6;
      }
      body.dark-mode .bg-white {
        background-color: #1f2937;
        color: #f3f4f6;
      }
      body.dark-mode .text-gray-800 {
        color: #f9fafb;
      }
      body.dark-mode .text-gray-600 {
        color: #d1d5db;
      }
      body.dark-mode .text-gray-500 {
        color: #9ca3af;
      }
      body.dark-mode .border-gray-200 {
        border-color: #374151;
      }
      body.dark-mode .bg-gray-50 {
        background-color: #111827;
      }
      body.dark-mode nav {
        background-color: #1f2937;
        border-color: #374151;
      }

      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
      }

      .sidebar-item {
        transition: all 0.2s ease;
        cursor: pointer;
      }
      .sidebar-item:hover {
        background: linear-gradient(
          to right,
          rgba(99, 102, 241, 0.1),
          transparent
        );
        border-left: 4px solid #6366f1;
      }
      .sidebar-item.active {
        background: linear-gradient(
          to right,
          rgba(99, 102, 241, 0.15),
          transparent
        );
        border-left: 4px solid #6366f1;
        font-weight: 600;
      }

      .fade-in {
        animation: fadeIn 0.4s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      ::-webkit-scrollbar-thumb {
        background: #c7c7c7;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        z-index: 100;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
        animation: fadeIn 0.3s;
      }
      .modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Switch Toggle */
      .toggle-checkbox:checked {
        right: 0;
        border-color: #68d391;
      }
      .toggle-checkbox:checked + .toggle-label {
        background-color: #68d391;
      }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-800">
    <!-- Navigation Bar -->
    <nav
      class="bg-white shadow-md border-b border-gray-200 fixed w-full top-0 z-50 transition-colors duration-300"
    >
      <div class="px-6 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <button
              id="sidebarToggle"
              class="lg:hidden text-gray-600 hover:text-gray-900"
            >
              <i class="fas fa-bars text-xl"></i>
            </button>
            <div class="flex items-center space-x-3">
              <div
                class="bg-gradient-to-br from-indigo-600 to-purple-600 p-2 rounded-lg shadow-lg"
              >
                <i class="fas fa-graduation-cap text-white text-xl"></i>
              </div>
              <div>
                <h1
                  class="text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent"
                >
                  MAKO Pro
                </h1>
                <p class="text-xs text-gray-500">Teacher Dashboard</p>
              </div>
            </div>
          </div>
          <div class="flex items-center space-x-4">
            <div
              class="flex items-center space-x-3 border-l pl-4 border-gray-300"
            >
              <img
                src="https://ui-avatars.com/api/?name=Seam+Mai&background=6366f1&color=fff"
                class="w-10 h-10 rounded-full ring-2 ring-indigo-100"
                alt="Profile"
              />
              <div class="hidden md:block">
                <p class="text-sm font-semibold">Dr. Seam Mai</p>
                <p class="text-xs text-gray-500">Computer Science Dept.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <div class="flex pt-16 h-screen">
      <!-- Sidebar -->
      <aside
        id="sidebar"
        class="fixed lg:static inset-y-0 left-0 w-64 bg-white shadow-xl transform -translate-x-full lg:translate-x-0 transition-transform duration-300 z-40 mt-16 overflow-y-auto pb-20 border-r border-gray-200"
      >
        <div class="p-6 space-y-2">
          <div
            onclick="router('dashboard')"
            class="sidebar-item active flex items-center space-x-3 px-4 py-3 rounded-lg"
            id="nav-dashboard"
          >
            <i class="fas fa-home text-indigo-600 w-5"></i
            ><span>Dashboard</span>
          </div>
          <div
            onclick="router('courses')"
            class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg"
            id="nav-courses"
          >
            <i class="fas fa-book text-gray-400 w-5"></i><span>My Courses</span>
          </div>
          <div
            onclick="router('students')"
            class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg"
            id="nav-students"
          >
            <i class="fas fa-users text-gray-400 w-5"></i><span>Students</span>
          </div>
          <div
            onclick="router('assignments')"
            class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg"
            id="nav-assignments"
          >
            <i class="fas fa-clipboard-check text-gray-400 w-5"></i
            ><span>Assignments</span>
          </div>
          <div
            onclick="router('grades')"
            class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg"
            id="nav-grades"
          >
            <i class="fas fa-file-alt text-gray-400 w-5"></i><span>Grades</span>
          </div>
          <div
            onclick="router('attendance')"
            class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg"
            id="nav-attendance"
          >
            <i class="fas fa-user-check text-gray-400 w-5"></i
            ><span>Attendance</span>
          </div>
          <div
            onclick="router('schedule')"
            class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg"
            id="nav-schedule"
          >
            <i class="fas fa-calendar-alt text-gray-400 w-5"></i
            ><span>Schedule</span>
          </div>
          <div
            onclick="router('messages')"
            class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg"
            id="nav-messages"
          >
            <i class="fas fa-comments text-gray-400 w-5"></i
            ><span>Messages</span>
          </div>
          <div
            onclick="router('analytics')"
            class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg"
            id="nav-analytics"
          >
            <i class="fas fa-chart-line text-gray-400 w-5"></i
            ><span>Analytics</span>
          </div>
          <div
            onclick="router('settings')"
            class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg"
            id="nav-settings"
          >
            <i class="fas fa-cog text-gray-400 w-5"></i><span>Settings</span>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main
        id="main-content"
        class="flex-1 p-6 lg:ml-0 fade-in overflow-y-auto bg-gray-50 h-full pb-20"
      >
        <!-- Content Injected Here -->
      </main>
    </div>

    <!-- GLOBAL MODALS CONTAINER -->
    <div id="modal-container"></div>

    <script>
      // ==========================================
      // 1. SIMULATED DATABASE & STATE
      // ==========================================
      const db = {
        courses: [
          {
            id: 1,
            name: "Spring Boot Framework",
            code: "ITE401",
            students: 15,
            max: 30,
            isFull: false,
            img: "fa-leaf",
            color: "green",
          },
          {
            id: 2,
            name: "Advanced Java",
            code: "ITE302",
            students: 15,
            max: 20,
            isFull: false,
            img: "fa-coffee",
            color: "red",
          },
          {
            id: 3,
            name: "Web Development (HTML)",
            code: "ITE101",
            students: 10,
            max: 40,
            isFull: false,
            img: "fa-code",
            color: "blue",
          },
          {
            id: 4,
            name: "C++ Programming",
            code: "CS201",
            students: 25,
            max: 25,
            isFull: true,
            img: "fa-microchip",
            color: "purple",
          },
        ],
        students: [], // Populated dynamically below
        assignments: [
          {
            id: 1,
            title: "REST API Design",
            courseId: 1,
            dueDate: "2025-12-25",
            pending: 5,
          },
          {
            id: 2,
            title: "Pointer Arithmetic",
            courseId: 4,
            dueDate: "2025-12-22",
            pending: 12,
          },
        ],
        messages: [
          {
            id: 1,
            from: "John Doe",
            text: "Sir, I will be late today.",
            time: "10:00 AM",
            unread: true,
          },
          {
            id: 2,
            from: "Admin",
            text: "Meeting at 2 PM.",
            time: "Yesterday",
            unread: false,
          },
        ],
      };

      // Generate Dummy Students
      const generateStudents = () => {
        const list = [];
        const courses = [1, 2, 3, 4]; // Course IDs
        // Create 60 students distributed across courses
        for (let i = 1; i <= 60; i++) {
          let cId = courses[Math.floor(Math.random() * courses.length)];
          // Force counts as requested: Java(1)=15, HTML(3)=10, C++(4)=25
          if (i <= 15) cId = 1;
          else if (i <= 25) cId = 3;
          else if (i <= 50) cId = 4;
          else cId = 2;

          list.push({
            id: `STU${2025000 + i}`,
            name: `Student ${i}`,
            email: `student${i}@school.edu`,
            courseId: cId,
            attendance: Math.floor(Math.random() * 30) + 70, // 70-100%
            assignmentStatus: Math.random() > 0.3 ? "Complete" : "Pending",
            grade: Math.floor(Math.random() * 100),
          });
        }
        return list;
      };
      db.students = generateStudents();

      // ==========================================
      // 2. ROUTER & UTILS
      // ==========================================
      function router(view) {
        // Update Sidebar
        document.querySelectorAll(".sidebar-item").forEach((item) => {
          item.classList.remove("active");
          item
            .querySelector("i")
            .classList.replace("text-indigo-600", "text-gray-400");
        });
        const activeItem = document.getElementById(`nav-${view}`);
        if (activeItem) {
          activeItem.classList.add("active");
          activeItem
            .querySelector("i")
            .classList.replace("text-gray-400", "text-indigo-600");
        }

        const main = document.getElementById("main-content");

        switch (view) {
          case "dashboard":
            main.innerHTML = renderDashboard();
            initCharts();
            break;
          case "courses":
            main.innerHTML = renderCourses();
            attachCourseEvents();
            break;
          case "students":
            main.innerHTML = renderStudents();
            break;
          case "assignments":
            main.innerHTML = renderAssignments();
            attachAssignmentEvents();
            break;
          case "grades":
            main.innerHTML = renderGrades();
            attachGradeEvents();
            break;
          case "attendance":
            main.innerHTML = renderAttendance();
            attachAttendanceEvents();
            break;
          case "schedule":
            main.innerHTML = renderSchedule();
            break;
          case "messages":
            main.innerHTML = renderMessages();
            attachMessageEvents();
            break;
          case "analytics":
            main.innerHTML = renderAnalytics();
            break;
          case "settings":
            main.innerHTML = renderSettings();
            attachSettingsEvents();
            break;
          default:
            main.innerHTML = `<h1 class="text-2xl">404 Not Found</h1>`;
        }
      }

      function closeModal(id) {
        document.getElementById(id).classList.remove("show");
        setTimeout(() => document.getElementById(id).remove(), 300);
      }

      function showModal(html) {
        const container = document.getElementById("modal-container");
        container.innerHTML = html;
        const modal = container.querySelector(".modal");
        modal.style.display = "flex";
        setTimeout(() => modal.classList.add("show"), 10);
      }

      // ==========================================
      // 3. VIEWS & LOGIC
      // ==========================================

      // --- DASHBOARD ---
      const renderDashboard = () => `
        <div class="mb-6 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl shadow-lg p-8 text-white">
          <h2 class="text-3xl font-bold mb-2">Welcome back, Dr. Mai! ðŸ‘‹</h2>
          <p class="text-indigo-100">You have 3 classes today.</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
           <div class="bg-white rounded-xl shadow p-6 border-l-4 border-indigo-600 card-hover">
             <p class="text-gray-500 text-sm">Total Students</p>
             <h3 class="text-3xl font-bold text-gray-800">${db.students.length}</h3>
           </div>
           <div class="bg-white rounded-xl shadow p-6 border-l-4 border-green-600 card-hover">
             <p class="text-gray-500 text-sm">Active Courses</p>
             <h3 class="text-3xl font-bold text-gray-800">${db.courses.length}</h3>
           </div>
           <div class="bg-white rounded-xl shadow p-6 border-l-4 border-yellow-500 card-hover">
             <p class="text-gray-500 text-sm">Assignments Pending</p>
             <h3 class="text-3xl font-bold text-gray-800">17</h3>
           </div>
           <div class="bg-white rounded-xl shadow p-6 border-l-4 border-red-500 card-hover">
             <p class="text-gray-500 text-sm">Avg Attendance</p>
             <h3 class="text-3xl font-bold text-gray-800">88%</h3>
           </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white p-6 rounded-xl shadow"><canvas id="mainChart" height="250"></canvas></div>
            <div class="bg-white p-6 rounded-xl shadow">
                <h3 class="font-bold mb-4">Recent Activity</h3>
                <ul class="space-y-3">
                    <li class="flex items-center space-x-3 text-sm"><div class="w-2 h-2 bg-green-500 rounded-full"></div><span>Added new course "Advanced AI"</span></li>
                    <li class="flex items-center space-x-3 text-sm"><div class="w-2 h-2 bg-blue-500 rounded-full"></div><span>Updated grades for ITE401</span></li>
                </ul>
            </div>
        </div>
      `;

      function initCharts() {
        const ctx = document.getElementById("mainChart").getContext("2d");
        new Chart(ctx, {
          type: "line",
          data: {
            labels: ["Mon", "Tue", "Wed", "Thu", "Fri"],
            datasets: [
              {
                label: "Attendance",
                data: [85, 88, 82, 90, 89],
                borderColor: "#6366f1",
                tension: 0.4,
              },
            ],
          },
        });
      }

      // --- COURSES ---
      const renderCourses = () => `
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold text-gray-800">My Courses</h2>
            <button id="btn-create-course" class="bg-indigo-600 text-white px-5 py-2 rounded-lg hover:bg-indigo-700 transition shadow">
                <i class="fas fa-plus mr-2"></i>Create Course
            </button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="courses-grid">
            ${db.courses
              .map(
                (c) => `
                <div class="bg-white rounded-xl shadow-md overflow-hidden card-hover border-t-4 border-${
                  c.color
                }-500">
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-4">
                            <div class="bg-${
                              c.color
                            }-100 p-3 rounded-xl"><i class="fas ${c.img} text-${
                  c.color
                }-600 text-xl"></i></div>
                            <div class="relative group">
                                <button class="text-gray-400 hover:text-gray-600"><i class="fas fa-ellipsis-v"></i></button>
                                <div class="hidden group-hover:block absolute right-0 mt-2 w-32 bg-white border rounded shadow-lg z-10">
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Edit</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">Archive</a>
                                </div>
                            </div>
                        </div>
                        <h3 class="text-lg font-bold text-gray-800">${
                          c.name
                        }</h3>
                        <p class="text-sm font-semibold text-indigo-600 mb-1">${
                          c.code
                        }</p>
                        <p class="text-sm text-gray-500 mb-4">${
                          c.students
                        } Students â€¢ ${
                  c.isFull
                    ? '<span class="text-red-500 font-bold">Full</span>'
                    : '<span class="text-green-500">Open</span>'
                }</p>
                        <div class="w-full bg-gray-100 rounded-full h-2 mb-2">
                            <div class="bg-${
                              c.color
                            }-500 h-2 rounded-full" style="width: ${
                  (c.students / c.max) * 100
                }%"></div>
                        </div>
                        <div class="flex justify-between text-xs text-gray-400">
                            <span>Progress</span>
                            <span>${Math.round(
                              (c.students / c.max) * 100
                            )}% Capacity</span>
                        </div>
                    </div>
                </div>
            `
              )
              .join("")}
        </div>
      `;

      function attachCourseEvents() {
        document
          .getElementById("btn-create-course")
          .addEventListener("click", () => {
            const modalHtml = `
            <div id="courseModal" class="modal">
                <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md mx-4">
                    <h3 class="text-xl font-bold mb-4">Create New Course</h3>
                    <form id="createCourseForm" class="space-y-4">
                        <div><label class="block text-sm font-medium text-gray-700">Course Name</label><input required type="text" id="cName" class="w-full border rounded p-2"></div>
                        <div><label class="block text-sm font-medium text-gray-700">Course Code (e.g. ITE401)</label><input required type="text" id="cCode" class="w-full border rounded p-2"></div>
                        <div><label class="block text-sm font-medium text-gray-700">Icon Class (FontAwesome)</label><input type="text" id="cIcon" value="fa-book" class="w-full border rounded p-2"></div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Status</label>
                            <div class="flex space-x-4 mt-1">
                                <label class="flex items-center"><input type="radio" name="cFull" value="false" checked class="mr-2"> Open for Registration</label>
                                <label class="flex items-center"><input type="radio" name="cFull" value="true" class="mr-2"> Full (Closed)</label>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-2 mt-6">
                            <button type="button" onclick="closeModal('courseModal')" class="bg-gray-200 text-gray-700 px-4 py-2 rounded">Cancel</button>
                            <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded">Create</button>
                        </div>
                    </form>
                </div>
            </div>`;
            showModal(modalHtml);

            document
              .getElementById("createCourseForm")
              .addEventListener("submit", (e) => {
                e.preventDefault();
                db.courses.push({
                  id: db.courses.length + 1,
                  name: document.getElementById("cName").value,
                  code: document.getElementById("cCode").value,
                  students: 0,
                  max: 40,
                  isFull:
                    document.querySelector('input[name="cFull"]:checked')
                      .value === "true",
                  img: document.getElementById("cIcon").value,
                  color: "indigo",
                });
                closeModal("courseModal");
                router("courses");
              });
          });
      }

      // --- STUDENTS ---
      const renderStudents = () => `
        <div class="mb-6"><h2 class="text-3xl font-bold text-gray-800">Students Directory</h2></div>
        <div class="bg-white rounded-xl shadow overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-gray-100 text-gray-600 uppercase text-xs">
                        <tr>
                            <th class="p-4">Student Name</th>
                            <th class="p-4">Course Enrolled</th>
                            <th class="p-4">Attendance</th>
                            <th class="p-4">Assignment Status</th>
                            <th class="p-4 text-center">Contact</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        ${db.students
                          .slice(0, 10)
                          .map((s) => {
                            const course = db.courses.find(
                              (c) => c.id === s.courseId
                            );
                            const assignColor =
                              s.assignmentStatus === "Complete"
                                ? "green"
                                : "red";
                            return `
                            <tr class="hover:bg-gray-50">
                                <td class="p-4 flex items-center gap-3">
                                    <img src="https://ui-avatars.com/api/?name=${
                                      s.name
                                    }&background=random" class="w-8 h-8 rounded-full">
                                    <div><p class="font-bold text-gray-800">${
                                      s.name
                                    }</p><p class="text-xs text-gray-500">${
                              s.id
                            }</p></div>
                                </td>
                                <td class="p-4"><span class="bg-indigo-100 text-indigo-700 py-1 px-3 rounded-full text-xs font-bold">${
                                  course.code
                                }</span></td>
                                <td class="p-4"><div class="flex items-center"><span class="mr-2 text-sm font-bold">${
                                  s.attendance
                                }%</span><div class="w-20 bg-gray-200 rounded h-1.5"><div class="bg-green-500 h-1.5 rounded" style="width:${
                              s.attendance
                            }%"></div></div></div></td>
                                <td class="p-4"><span class="text-${assignColor}-600 text-sm font-medium"><i class="fas fa-${
                              s.assignmentStatus === "Complete"
                                ? "check"
                                : "times"
                            }-circle mr-1"></i>${s.assignmentStatus}</span></td>
                                <td class="p-4 text-center">
                                    <button onclick="alert('Contacting ${
                                      s.name
                                    }...')" class="bg-blue-50 text-blue-600 hover:bg-blue-100 p-2 rounded-lg transition"><i class="fas fa-envelope"></i></button>
                                </td>
                            </tr>
                        `;
                          })
                          .join("")}
                    </tbody>
                </table>
            </div>
            <div class="p-4 bg-gray-50 border-t text-center text-sm text-gray-500">Showing top 10 students (Simulation)</div>
        </div>
      `;

      // --- ASSIGNMENTS ---
      const renderAssignments = () => {
        const pendingCount = db.students.filter(
          (s) => s.assignmentStatus === "Pending"
        ).length;
        return `
        ${
          pendingCount > 0
            ? `
        <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-r shadow-sm flex justify-between items-center" role="alert">
            <div><p class="font-bold">Attention Needed</p><p>${pendingCount} students have not completed their assignments yet.</p></div>
            <i class="fas fa-exclamation-circle text-2xl opacity-50"></i>
        </div>`
            : ""
        }

        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold text-gray-800">Assignments</h2>
            <button id="btn-create-assign" class="bg-indigo-600 text-white px-5 py-2 rounded-lg hover:bg-indigo-700 transition shadow"><i class="fas fa-plus mr-2"></i>Create Assignment</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${db.assignments
              .map((a) => {
                const course = db.courses.find((c) => c.id === a.courseId);
                return `
                <div class="bg-white rounded-xl shadow-md p-6 card-hover border-t-4 border-indigo-500 flex flex-col justify-between h-full">
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-1 rounded uppercase">${course.code}</span>
                            <span class="text-xs text-red-500 font-semibold">Due: ${a.dueDate}</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">${a.title}</h3>
                        <p class="text-gray-500 text-sm mb-4">Professional assignment designed to test core concepts.</p>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-100 flex justify-between items-center">
                        <span class="text-sm text-gray-600"><i class="fas fa-user-clock mr-1"></i> ${a.pending} Pending</span>
                        <button class="text-indigo-600 font-medium text-sm hover:underline">View Submissions</button>
                    </div>
                </div>
            `;
              })
              .join("")}
        </div>
      `;
      };

      function attachAssignmentEvents() {
        document
          .getElementById("btn-create-assign")
          .addEventListener("click", () => {
            const options = db.courses
              .map(
                (c) => `<option value="${c.id}">${c.name} (${c.code})</option>`
              )
              .join("");
            showModal(`
                <div id="assignModal" class="modal">
                    <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4">
                        <h3 class="text-xl font-bold mb-4">Create Professional Assignment</h3>
                        <form id="assignForm" class="space-y-4">
                            <div><label class="block text-sm font-medium">Title</label><input required type="text" id="aTitle" class="w-full border rounded p-2"></div>
                            <div><label class="block text-sm font-medium">Description</label><textarea class="w-full border rounded p-2" rows="3"></textarea></div>
                            <div class="grid grid-cols-2 gap-4">
                                <div><label class="block text-sm font-medium">Course</label><select id="aCourse" class="w-full border rounded p-2">${options}</select></div>
                                <div><label class="block text-sm font-medium">Due Date</label><input required type="date" id="aDate" class="w-full border rounded p-2"></div>
                            </div>
                            <div class="bg-yellow-50 p-3 rounded text-sm text-yellow-800"><i class="fas fa-info-circle mr-1"></i> Teachers will be notified if students miss this deadline.</div>
                            <div class="flex justify-end space-x-2 mt-4">
                                <button type="button" onclick="closeModal('assignModal')" class="bg-gray-200 px-4 py-2 rounded">Cancel</button>
                                <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded">Assign</button>
                            </div>
                        </form>
                    </div>
                </div>
             `);
            document
              .getElementById("assignForm")
              .addEventListener("submit", (e) => {
                e.preventDefault();
                db.assignments.push({
                  id: db.assignments.length + 1,
                  title: document.getElementById("aTitle").value,
                  courseId: parseInt(document.getElementById("aCourse").value),
                  dueDate: document.getElementById("aDate").value,
                  pending: 0,
                });
                closeModal("assignModal");
                router("assignments");
              });
          });
      }

      // --- GRADES ---
      let isGradeTableView = false;
      const renderGrades = () => `
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold text-gray-800">Gradebook</h2>
            <div class="flex items-center space-x-3 bg-white px-3 py-1 rounded-full shadow-sm border">
                <span class="text-sm ${
                  !isGradeTableView
                    ? "font-bold text-indigo-600"
                    : "text-gray-500"
                }">Cards</span>
                <label for="viewToggle" class="flex items-center cursor-pointer relative">
                    <input type="checkbox" id="viewToggle" class="sr-only toggle-checkbox" ${
                      isGradeTableView ? "checked" : ""
                    }>
                    <div class="w-10 h-6 bg-gray-200 rounded-full border border-gray-300 toggle-label transition duration-300"></div>
                    <div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition transform duration-300 ${
                      isGradeTableView
                        ? "translate-x-full border-indigo-600"
                        : ""
                    }"></div>
                </label>
                <span class="text-sm ${
                  isGradeTableView
                    ? "font-bold text-indigo-600"
                    : "text-gray-500"
                }">Table</span>
            </div>
        </div>
        
        ${
          !isGradeTableView
            ? // CARD VIEW
              `<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                ${db.students
                  .slice(0, 9)
                  .map(
                    (s) => `
                    <div class="bg-white rounded-xl shadow border border-gray-100 p-5 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-2"><i class="fas fa-pen text-gray-300 hover:text-indigo-600 cursor-pointer"></i></div>
                        <div class="flex items-center space-x-3 mb-4">
                            <img src="https://ui-avatars.com/api/?name=${
                              s.name
                            }&background=random" class="w-12 h-12 rounded-full">
                            <div><h4 class="font-bold text-gray-800">${
                              s.name
                            }</h4><p class="text-xs text-gray-500">${
                      s.id
                    }</p></div>
                        </div>
                        <div class="flex justify-between items-end">
                            <div><p class="text-xs text-gray-500">Total Score</p><p class="text-2xl font-bold text-indigo-600">${
                              s.grade
                            }/100</p></div>
                            <div class="text-4xl font-black text-gray-100">${
                              s.grade >= 90 ? "A" : s.grade >= 80 ? "B" : "C"
                            }</div>
                        </div>
                    </div>
                `
                  )
                  .join("")}
             </div>`
            : // TABLE VIEW (Editable)
              `<div class="bg-white rounded-xl shadow overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-indigo-50 border-b">
                        <tr><th class="p-4">Student</th><th class="p-4">ID</th><th class="p-4">Points (0-100)</th><th class="p-4">Grade</th><th class="p-4">Actions</th></tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        ${db.students
                          .slice(0, 15)
                          .map(
                            (s) => `
                            <tr>
                                <td class="p-3 font-medium text-gray-700">${
                                  s.name
                                }</td>
                                <td class="p-3 text-gray-500">${s.id}</td>
                                <td class="p-3"><input type="number" value="${
                                  s.grade
                                }" class="border rounded w-20 p-1 text-center grade-input" data-id="${
                              s.id
                            }"></td>
                                <td class="p-3 font-bold text-indigo-600" id="grade-letter-${
                                  s.id
                                }">${
                              s.grade >= 90
                                ? "A"
                                : s.grade >= 80
                                ? "B"
                                : s.grade >= 70
                                ? "C"
                                : "F"
                            }</td>
                                <td class="p-3"><button class="text-blue-600 hover:underline">Save</button></td>
                            </tr>
                        `
                          )
                          .join("")}
                    </tbody>
                </table>
             </div>`
        }
      `;

      function attachGradeEvents() {
        const toggle = document.getElementById("viewToggle");
        if (toggle) {
          toggle.addEventListener("change", (e) => {
            isGradeTableView = e.target.checked;
            router("grades");
          });
        }
        // Input logic for table
        document.querySelectorAll(".grade-input").forEach((input) => {
          input.addEventListener("input", (e) => {
            const val = parseInt(e.target.value);
            const id = e.target.dataset.id;
            const letter =
              val >= 90 ? "A" : val >= 80 ? "B" : val >= 70 ? "C" : "F";
            document.getElementById(`grade-letter-${id}`).textContent = letter;
            // Update "DB"
            const s = db.students.find((stu) => stu.id === id);
            if (s) s.grade = val;
          });
        });
      }

      // --- ATTENDANCE ---
      let attendancePage = 1;
      let attendanceCourseFilter = 1; // Default Spring Boot
      const itemsPerPage = 10;

      const renderAttendance = () => {
        const filteredStudents = db.students.filter(
          (s) => s.courseId == attendanceCourseFilter
        );
        const totalPages = Math.ceil(filteredStudents.length / itemsPerPage);
        const paginated = filteredStudents.slice(
          (attendancePage - 1) * itemsPerPage,
          attendancePage * itemsPerPage
        );

        return `
          <div class="mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
            <h2 class="text-3xl font-bold text-gray-800">Attendance</h2>
            <div class="flex gap-2">
                 <select id="attFilter" class="border p-2 rounded-lg shadow-sm bg-white">
                    ${db.courses
                      .map(
                        (c) =>
                          `<option value="${c.id}" ${
                            c.id == attendanceCourseFilter ? "selected" : ""
                          }>${c.name} (${c.students} Students)</option>`
                      )
                      .join("")}
                 </select>
                 <button onclick="alert('Exporting CSV...')" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700"><i class="fas fa-file-export mr-2"></i>Export</button>
            </div>
          </div>
          
          <div class="bg-white rounded-xl shadow overflow-hidden">
             <div class="bg-gray-50 border-b p-4 flex justify-between items-center">
                <span class="font-bold text-gray-700">Class List</span>
                <span class="text-sm text-gray-500">${
                  filteredStudents.length
                } Students found</span>
             </div>
             <table class="w-full text-left">
                <thead class="bg-gray-100 text-xs uppercase text-gray-600">
                    <tr><th class="p-4">Student</th><th class="p-4">Status</th><th class="p-4">Check-in Time</th><th class="p-4">Actions</th></tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    ${paginated
                      .map(
                        (s) => `
                        <tr>
                            <td class="p-4 font-medium">${
                              s.name
                            } <br><span class="text-xs text-gray-400">${
                          s.id
                        }</span></td>
                            <td class="p-4"><span class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-bold">Present</span></td>
                            <td class="p-4 text-sm text-gray-600">08:0${Math.floor(
                              Math.random() * 9
                            )} AM</td>
                            <td class="p-4">
                                <select class="border rounded text-sm p-1">
                                    <option>Present</option><option>Absent</option><option>Late</option>
                                </select>
                            </td>
                        </tr>
                    `
                      )
                      .join("")}
                </tbody>
             </table>
             <!-- Pagination -->
             <div class="p-4 border-t flex justify-between items-center bg-gray-50">
                <button id="prevPage" ${
                  attendancePage === 1
                    ? 'disabled class="text-gray-300"'
                    : 'class="text-indigo-600 hover:underline"'
                }><i class="fas fa-chevron-left mr-1"></i> Previous</button>
                <span class="text-sm text-gray-600">Page ${attendancePage} of ${totalPages}</span>
                <button id="nextPage" ${
                  attendancePage === totalPages
                    ? 'disabled class="text-gray-300"'
                    : 'class="text-indigo-600 hover:underline"'
                } >Next <i class="fas fa-chevron-right ml-1"></i></button>
             </div>
          </div>
      `;
      };

      function attachAttendanceEvents() {
        document.getElementById("attFilter").addEventListener("change", (e) => {
          attendanceCourseFilter = e.target.value;
          attendancePage = 1;
          router("attendance");
        });
        document.getElementById("prevPage").addEventListener("click", () => {
          if (attendancePage > 1) {
            attendancePage--;
            router("attendance");
          }
        });
        document.getElementById("nextPage").addEventListener("click", () => {
          const total = Math.ceil(
            db.students.filter((s) => s.courseId == attendanceCourseFilter)
              .length / itemsPerPage
          );
          if (attendancePage < total) {
            attendancePage++;
            router("attendance");
          }
        });
      }

      // --- SCHEDULE ---
      const renderSchedule = () => `
        <h2 class="text-3xl font-bold text-gray-800 mb-6">Teaching Schedule</h2>
        <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
            <!-- Time Column -->
            <div class="col-span-1 space-y-6 mt-12 hidden lg:block text-right pr-4 text-gray-400 text-sm">
                <div class="h-32">08:00 AM</div>
                <div class="h-32">10:00 AM</div>
                <div class="h-32">01:00 PM</div>
            </div>
            
            <!-- Days Columns (Simplified for demo) -->
            <div class="col-span-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="space-y-4">
                    <h3 class="font-bold text-gray-500 mb-2">Today (Monday)</h3>
                    ${db.courses
                      .slice(0, 2)
                      .map(
                        (c, i) => `
                        <div class="bg-white p-4 rounded-xl shadow-md border-l-4 border-${
                          c.color
                        }-500 h-32 flex flex-col justify-center">
                            <div class="flex justify-between font-bold text-gray-800"><span>${
                              c.name
                            }</span><span>${
                          i === 0 ? "08:00" : "10:00"
                        }</span></div>
                            <div class="text-sm text-gray-500 mt-1">${
                              c.code
                            } â€¢ Room 30${i + 1}</div>
                            <div class="mt-3 flex -space-x-2">
                                <img class="w-8 h-8 rounded-full border-2 border-white" src="https://ui-avatars.com/api/?name=A&background=random">
                                <img class="w-8 h-8 rounded-full border-2 border-white" src="https://ui-avatars.com/api/?name=B&background=random">
                                <div class="w-8 h-8 rounded-full border-2 border-white bg-gray-200 flex items-center justify-center text-xs text-gray-600">+${
                                  c.students - 2
                                }</div>
                            </div>
                        </div>
                    `
                      )
                      .join("")}
                </div>
                <div class="space-y-4">
                    <h3 class="font-bold text-gray-500 mb-2">Tomorrow (Tuesday)</h3>
                     ${db.courses
                       .slice(2, 4)
                       .map(
                         (c, i) => `
                        <div class="bg-white p-4 rounded-xl shadow-md border-l-4 border-${
                          c.color
                        }-500 h-32 flex flex-col justify-center opacity-75">
                            <div class="flex justify-between font-bold text-gray-800"><span>${
                              c.name
                            }</span><span>${
                           i === 0 ? "09:00" : "01:00"
                         }</span></div>
                            <div class="text-sm text-gray-500 mt-1">${
                              c.code
                            } â€¢ Lab 4</div>
                        </div>
                    `
                       )
                       .join("")}
                </div>
            </div>
        </div>
      `;

      // --- MESSAGES (Telegram Style) ---
      const renderMessages = () => `
        <div class="h-[calc(100vh-140px)] flex bg-white rounded-xl shadow-xl overflow-hidden">
            <!-- Sidebar List -->
            <div class="w-1/3 border-r bg-gray-50 flex flex-col">
                <div class="p-4 border-b bg-white">
                    <input type="text" placeholder="Search..." class="w-full bg-gray-100 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div class="overflow-y-auto flex-1">
                    ${db.messages
                      .map(
                        (m) => `
                        <div class="p-4 border-b hover:bg-white cursor-pointer transition ${
                          m.unread ? "bg-indigo-50" : ""
                        }">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-bold text-gray-800">${
                                  m.from
                                }</span>
                                <span class="text-xs text-gray-500">${
                                  m.time
                                }</span>
                            </div>
                            <p class="text-sm text-gray-600 truncate">${
                              m.text
                            }</p>
                        </div>
                    `
                      )
                      .join("")}
                </div>
            </div>
            <!-- Chat Area -->
            <div class="flex-1 flex flex-col">
                <div class="p-4 border-b bg-white flex justify-between items-center">
                    <h3 class="font-bold text-lg"><i class="fab fa-telegram text-blue-500 mr-2"></i>John Doe</h3>
                    <i class="fas fa-ellipsis-h text-gray-400 cursor-pointer"></i>
                </div>
                <div class="flex-1 bg-gray-100 p-6 overflow-y-auto space-y-4" id="chatContainer">
                    <div class="flex justify-start"><div class="bg-white p-3 rounded-lg rounded-tl-none shadow-sm max-w-xs text-sm">Hello Professor, I have a question about the assignment.</div></div>
                    <div class="flex justify-end"><div class="bg-indigo-600 text-white p-3 rounded-lg rounded-tr-none shadow-sm max-w-xs text-sm">Sure, go ahead.</div></div>
                    <div class="flex justify-start"><div class="bg-white p-3 rounded-lg rounded-tl-none shadow-sm max-w-xs text-sm">I will be late today due to traffic.</div></div>
                </div>
                <div class="p-4 bg-white border-t">
                    <form id="msgForm" class="flex gap-2">
                        <input type="text" id="msgInput" placeholder="Write a message..." class="flex-1 border rounded-full px-4 py-2 focus:outline-none focus:border-indigo-500">
                        <button type="submit" class="bg-indigo-600 text-white w-10 h-10 rounded-full hover:bg-indigo-700 transition"><i class="fas fa-paper-plane"></i></button>
                    </form>
                </div>
            </div>
        </div>
      `;

      function attachMessageEvents() {
        document.getElementById("msgForm").addEventListener("submit", (e) => {
          e.preventDefault();
          const input = document.getElementById("msgInput");
          const text = input.value;
          if (!text) return;

          const container = document.getElementById("chatContainer");
          container.innerHTML += `<div class="flex justify-end fade-in"><div class="bg-indigo-600 text-white p-3 rounded-lg rounded-tr-none shadow-sm max-w-xs text-sm">${text}</div></div>`;
          container.scrollTop = container.scrollHeight;

          // Simulate DB save
          db.messages.push({
            id: Date.now(),
            from: "Me",
            text: text,
            time: "Now",
            unread: false,
          });
          input.value = "";
        });
      }

      // --- ANALYTICS ---
      const renderAnalytics = () => `
         <h2 class="text-3xl font-bold text-gray-800 mb-6">Performance Analytics</h2>
         <div class="bg-white p-6 rounded-xl shadow mb-6">
            <h3 class="font-bold mb-4">Monthly Attendance Overview</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-center border-collapse text-sm">
                    <thead>
                        <tr><th class="p-2 text-left">Student</th>${Array.from(
                          { length: 10 },
                          (_, i) => `<th class="p-2 border-l">Day ${i + 1}</th>`
                        ).join("")}</tr>
                    </thead>
                    <tbody>
                        ${db.students
                          .slice(0, 5)
                          .map(
                            (s) => `
                            <tr class="border-t">
                                <td class="p-3 text-left font-bold">${
                                  s.name
                                }</td>
                                ${Array.from({ length: 10 }, () =>
                                  Math.random() > 0.1
                                    ? '<td class="p-2 border-l text-green-500"><i class="fas fa-check"></i></td>'
                                    : '<td class="p-2 border-l text-red-500"><i class="fas fa-times"></i></td>'
                                ).join("")}
                            </tr>
                        `
                          )
                          .join("")}
                    </tbody>
                </table>
            </div>
         </div>
      `;

      // --- SETTINGS ---
      const renderSettings = () => `
         <h2 class="text-3xl font-bold text-gray-800 mb-6">System Settings</h2>
         <div class="max-w-2xl bg-white rounded-xl shadow p-8">
            <div class="flex items-center justify-between mb-8 pb-8 border-b">
                <div>
                    <h3 class="font-bold text-lg">Dark Mode</h3>
                    <p class="text-gray-500 text-sm">Switch between light and dark themes</p>
                </div>
                <button id="themeToggle" class="bg-gray-200 relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:ring-offset-2">
                    <span aria-hidden="true" class="translate-x-0 pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"></span>
                </button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <h3 class="font-bold text-lg mb-4">School Profile</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" value="University of Technology" class="border p-2 rounded">
                        <input type="text" value="Academic Year 2025" class="border p-2 rounded">
                    </div>
                </div>
                <div class="pt-4">
                    <button class="bg-red-50 text-red-600 border border-red-200 px-4 py-2 rounded font-medium hover:bg-red-100">Reset System Data</button>
                    <button class="bg-indigo-600 text-white px-4 py-2 rounded font-medium ml-2 hover:bg-indigo-700">Save Changes</button>
                </div>
            </div>
         </div>
      `;

      function attachSettingsEvents() {
        const btn = document.getElementById("themeToggle");
        const span = btn.querySelector("span");
        const isDark = document.body.classList.contains("dark-mode");

        if (isDark) {
          btn.classList.replace("bg-gray-200", "bg-indigo-600");
          span.classList.replace("translate-x-0", "translate-x-5");
        }

        btn.addEventListener("click", () => {
          document.body.classList.toggle("dark-mode");
          const dark = document.body.classList.contains("dark-mode");
          if (dark) {
            btn.classList.replace("bg-gray-200", "bg-indigo-600");
            span.classList.replace("translate-x-0", "translate-x-5");
          } else {
            btn.classList.replace("bg-indigo-600", "bg-gray-200");
            span.classList.replace("translate-x-5", "translate-x-0");
          }
        });
      }

      // ==========================================
      // INITIALIZATION
      // ==========================================
      document.addEventListener("DOMContentLoaded", () => {
        router("dashboard"); // Load default view

        // Mobile Sidebar
        document
          .getElementById("sidebarToggle")
          .addEventListener("click", () => {
            document
              .getElementById("sidebar")
              .classList.toggle("-translate-x-full");
          });
      });
    </script>
  </body>
</html>
